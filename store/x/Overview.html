<!DOCTYPE html>
<html lang="en" data-layout="section">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="T8 Store: Overview">
  <title>Overview | T8 Store</title>
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.3/dist/css/base.css">
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.3/dist/css/section.css">
  <link rel="icon" type="image/png" href="/assets/t8.png">
</head>
<body>
<div class="layout">
<div class="body">
<main>
<h1><a href="/store/">T8 Store</a></h1>
<h2 id="Exports">Exports</h2>
<p>This package exports two classes: <code>Store</code> and its subclass <code>PersistentStore</code>. A <code>Store</code> object is a thin container for data of arbitrary type, exposing methods to get and set the contained value and allowing to subscribe to its value updates. It can be used as a data storage, or state, shared by multiple independent parts of code that need to be notified when the data gets updated. <code>PersistentStore</code> is a version of <code>Store</code> enchanced to make the contained value persistent across page reloads via <code>localStorage</code> or <code>sessionStorage</code>.</p>
<p>Stores can be used as shared state with libraries like React, see <a href="/react-store">React Store</a> exposing a ready-to-use hook for shared state management.</p>
<h2 id="Initialization">Initialization</h2>
<p>Stores accept data of any kind.</p>
<pre><code class="language-js">import { Store } from "@t8/store";

// With a primitive value
let store1 = new Store(0);

// With a nonprimitive value
let store2 = new Store({ counter: 0 });
</code></pre>
<p>Similarly to instances of the built-in data container classes, such as <code>Set</code> and <code>Map</code>, stores are created as <code>new Store(value)</code> rather than with a factory function.</p>
<h2 id="Value_manipulation">Value manipulation</h2>
<p>The store value can be read and updated with <code>getValue()</code> and <code>setValue(update)</code>. <code>setValue(update)</code> accepts either a new value or a function <code>(value) =&gt; nextValue</code> that returns a new store value based on the current store value.</p>
<pre><code class="language-js">let store = new Store({ counter: 0 });

store.setValue({ counter: 100 });
store.setValue((value) =&gt; ({ ...value, counter: value.counter + 1 }));

let value = store.getValue();
console.log(value.counter); // 101
</code></pre>
<h2 id="Subscription_to_updates">Subscription to updates</h2>
<p>A callback passed to the <code>onUpdate(callback)</code> method is called each time the store value is updated via <code>setValue(value)</code>.</p>
<pre><code class="language-js">let unsubscribe = store.onUpdate((nextValue, prevValue) =&gt; {
  console.log(nextValue, prevValue);
});
</code></pre>
<p><code>onUpdate(callback)</code> returns an unsubscription function. Once it's invoked, the given <code>callback</code> is removed from the store and no longer called when the store is updated.</p>
<h2 id="Persistence_across_page_reloads">Persistence across page reloads</h2>
<pre><code class="language-js">import { PersistentStore } from "@t8/store";

let counterStore = new PersistentStore(0, "counter");
</code></pre>
<p>Whenever updated, <code>counterStore</code> above will save its value to the <code>"counter"</code> key of <code>localStorage</code>. (Pass <code>{ session: true }</code> as the third parameter of <code>new PersistentStore()</code> to use <code>sessionStorage</code> instead of <code>localStorage</code>.)</p>
<p>The following call signals the store to read the value from the browser storage, which can be used once or multiple times after creating the store:</p>
<pre><code class="language-js">counterStore.sync();
</code></pre>
<p>If it's desirable to sync a store with the browser storage just once regardless of the number of sync calls (coming from multiple independent parts of the code, for example), <code>syncOnce()</code> calls can be used instead:</p>
<pre><code class="language-js">counterStore.syncOnce(); // Syncs once disregarding subsequent syncOnce() calls
</code></pre>
<p>The way the store value gets saved to and restored from a browser storage entry (including filtering out certain data or otherwise rearranging the saved data) can be redefined by setting <code>options.serialize</code> and <code>options.deserialize</code> in <code>new PersistentStore(value, storageKey, options)</code>. By default, these options act like <code>JSON.stringify()</code> and <code>JSON.parse()</code> respectively.</p>
<p class="pagenav">
  <span class="prev">
    <span class="icon">←</span>
    <a href="/store/">Intro</a>
  </span>
  <span class="sep">|</span>
  <span class="repo next"><a href="https://github.com/t8js/store" target="_blank">GitHub</a> <span class="icon">✦</span></span>
</p>
</main>
<hr>
<nav class="aux">
<section>
<p class="title">Contents</p>
<ul><li><a href="/store/x/Overview#Exports">Exports</a></li>
<li><a href="/store/x/Overview#Initialization">Initialization</a></li>
<li><a href="/store/x/Overview#Value_manipulation">Value manipulation</a></li>
<li><a href="/store/x/Overview#Subscription_to_updates">Subscription to updates</a></li>
<li><a href="/store/x/Overview#Persistence_across_page_reloads">Persistence across page reloads</a></li>
</ul>
<p class="title">Resources</p>
<ul>
  <li><a href="https://github.com/t8js/store" target="_blank">GitHub</a></li>
  <li><a href="https://www.npmjs.com/package/@t8/store" target="_blank">npm</a></li>
</ul>
</section>
<section class="related">
  <p class="title">Also with vanilla TS/JS</p>
  <ul>
    <li><a href="/router" data-name="@t8/router">T8 Router</a></li>
  </ul>
  <p class="title">With React</p>
  <ul>
    <li><a href="/react-router" data-name="@t8/react-router">T8 React Router</a></li>
    <li><a href="/react-store" data-name="@t8/react-store">T8 React Store</a></li>
    <li><a href="/react-pending" data-name="@t8/react-pending">T8 React Pending</a></li>
  </ul>
</section>
</nav>
</div>
</div>
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/stackoverflow-light.min.css" media="(prefers-color-scheme: light)">
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/base16/material.min.css" media="(prefers-color-scheme: dark)">
<link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.3/dist/css/code.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
<script>hljs.highlightAll()</script>
<script src="/assets/stats.js"></script>
</body>
</html>
