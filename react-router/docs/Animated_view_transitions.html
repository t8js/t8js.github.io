<!DOCTYPE html>
<html lang="en" data-layout="section">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="T8 React Router: Animated view transitions">
  <title>Animated view transitions | T8 React Router</title>
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.4/dist/css/base.css">
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.4/dist/css/section.css">
  <link rel="icon" type="image/png" href="/assets/icon.png">
  <link rel="prefetch" href="/react-router/docs/Converting_HTML_links_to_SPA_route_links">
  <link rel="prefetch" href="/react-router/docs/Lazy_routes">
  <link rel="stylesheet" href="/assets/entry.css">
</head>
<body>
<div class="layout">
<div class="body">
<main>
<h1><a href="/react-router/">T8 React Router</a></h1>
<h2>Animated view transitions</h2>
<p>Animated transitions between different routes can be achieved by using the browser's <a href="https://developer.mozilla.org/en-US/docs/Web/API/View_Transition_API" target="_blank">View Transition API</a> and the optional <code>callback</code> parameter of <code>useRoute()</code> can be used to set up such a transition.</p>
<pre><code class="language-diff">+ import { flushSync } from "react-dom";
  import { A, useRoute } from "@t8/react-router";

+ function renderViewTransition(render) {
+   if (document.startViewTransition) {
+     document.startViewTransition(() =&gt; {
+       flushSync(render);
+     });
+   }
+   else render();
+ }

  export const App = () =&gt; {
-   let { at } = useRoute();
+   let { at } = useRoute(renderViewTransition);

    return (
      // Content
    );
  };
</code></pre>
<fieldset><legend>Live demo</legend><iframe class="csb" src="https://codesandbox.io/embed/znvrmt?view=preview&amp;hidedevtools=1&amp;theme=dark&amp;fontsize=12&amp;module=%252Fsrc%252FApp.tsx" title="Live demo" style="height: 380px;" sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts" loading="lazy"></iframe></fieldset>
<p>In the example above, the <code>renderViewTransition()</code> function passed to <code>useRoute()</code> calls <code>document.startViewTransition()</code> from the View Transition API to start a view transition and React's <code>flushSync()</code> to apply the DOM changes synchronously within the view transition, with the visual effects defined with CSS. We also check whether <code>document.startViewTransition</code> is supported by the browser and resort to regular rendering if it's not.</p>
<p>To trigger a transition only with specific links, the <code>options</code> parameter of the <code>useRoute()</code> callback can be used to add a condition for the view transitions. In the example below, we'll only trigger a view transition with the links whose <code>data-id</code> attribute, available via <code>options.id</code>, is among the listed on <code>viewTransitionLinkIds</code>.</p>
<pre><code class="language-diff">+ let viewTransitionLinkIds = new Set([/* ... */]);

  function renderViewTransition(render, options) {
-   if (document.startViewTransition) {
+   if (document.startViewTransition &amp;&amp; viewTransitionLinkIds.has(options.id)) {
      document.startViewTransition(() =&gt; {
        flushSync(render);
      });
    }
    else render();
  }
</code></pre>
<p class="pagenav">
  <span class="prev"><span class="icon">←</span> <a href="/react-router/docs/Lazy_routes">Lazy routes</a></span>
  <span class="sep">|</span>
  <span class="next"><a href="/react-router/docs/Converting_HTML_links_to_SPA_route_links">Converting HTML links to SPA route links</a> <span class="icon">→</span></span>
</p>
</main>
<hr>
<aside class="aux">
<nav>
<section>
<p class="title">Contents</p>
<ul><li data-id="Routing"><a href="/react-router/docs/Routing">Routing</a></li>
<li data-id="Navigation"><a href="/react-router/docs/Navigation">Navigation</a></li>
<li data-id="Link_props"><a href="/react-router/docs/Link_props">Link props</a></li>
<li data-id="Middleware"><a href="/react-router/docs/Middleware">Middleware</a></li>
<li data-id="URL_parameters"><a href="/react-router/docs/URL_parameters">URL parameters</a></li>
<li data-id="Type_safety"><a href="/react-router/docs/Type_safety">Type safety</a></li>
<li data-id="Nested_routes"><a href="/react-router/docs/Nested_routes">Nested routes</a></li>
<li data-id="URL_provider"><a href="/react-router/docs/URL_provider">URL provider</a></li>
<li data-id="Custom_routing_behavior"><a href="/react-router/docs/Custom_routing_behavior">Custom routing behavior</a></li>
<li data-id="Unknown_routes"><a href="/react-router/docs/Unknown_routes">Unknown routes</a></li>
<li data-id="Lazy_routes"><a href="/react-router/docs/Lazy_routes">Lazy routes</a></li>
<li data-id="Animated_view_transitions"><strong>Animated view transitions</strong></li>
<li data-id="Converting_HTML_links_to_SPA_route_links"><a href="/react-router/docs/Converting_HTML_links_to_SPA_route_links">Converting HTML links to SPA route links</a></li>
</ul>
<p class="title">Resources</p>
<ul>
  <li><a href="https://github.com/axcraft/react-router" target="_blank">GitHub</a></li>
  <li><a href="https://www.npmjs.com/package/@t8/react-router" target="_blank">npm</a></li>
</ul>
</section>
<section class="related">
  <p class="title">Also with React</p>
  <ul>
    <li><a href="/react-store" data-name="@t8/react-store">T8 React Store</a></li>
    <li><a href="/react-pending" data-name="@t8/react-pending">T8 React Pending</a></li>
  </ul>
  <p class="title">Vanilla TS/JS</p>
  <ul>
    <li><a href="/router" data-name="@t8/router">T8 Router</a></li>
    <li><a href="/store" data-name="@t8/store">T8 Store</a></li>
    <li><a href="https://github.com/axcraft/persistent-store" data-name="@t8/persistent-store">T8 Persistent Store</a></li>
  </ul>
</section>
</nav>
</aside>
</div>
</div>
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/stackoverflow-light.min.css" media="(prefers-color-scheme: light)">
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/base16/material.min.css" media="(prefers-color-scheme: dark)">
<link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.4/dist/css/code.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
<script>hljs.highlightAll()</script>
<script src="/assets/stats.js"></script>
</body>
</html>
