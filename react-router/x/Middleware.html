<!DOCTYPE html>
<html lang="en" data-layout="section">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="T8 React Router: Middleware">
  <title>Middleware | T8 React Router</title>
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.3/dist/css/base.css">
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.3/dist/css/section.css">
  <link rel="icon" type="image/png" href="/assets/t8.png">
  <link rel="prefetch" href="/react-router/x/URL_parameters">
  <link rel="prefetch" href="/react-router/x/Link_props">
</head>
<body>
<div class="layout">
<div class="body">
<main>
<h1><a href="/react-router/">T8 React Router</a></h1>
<h2>Middleware</h2>
<p>The <code>useNavigationStart()</code> and <code>useNavigationComplete()</code> hooks define routing <em>middleware</em>, that is optional intermediate actions to be done before and after the route navigation occurs:</p>
<pre><code class="language-jsx">import { useNavigationComplete, useNavigationStart } from "@t8/react-router";

function setTitle({ href }) {
  if (href === "/intro")
    document.title = "Intro";
}

let App = () =&gt; {
  let { route } = useRoute();
  let [hasUnsavedChanges, setUnsavedChanges] = useState(false);

  let handleNavigationStart = useCallback(({ href }) =&gt; {
    if (hasUnsavedChanges)
      return false; // prevents navigation

    if (href === "/intro") {
      route.assign("/"); // redirection
      return false;
    }
  }, [hasUnsavedChanges, route]);

  useNavigationStart(handleNavigationStart);
  useNavigationComplete(setTitle);

  return (
    // app content
  );
};
</code></pre>
<p>This example shows some common examples of what can be handled with routing middleware: preventing navigation with unsaved user input, redirecting to another location, setting the page title based on the current location.</p>
<p>⬥ The object passed to the middleware callback defines the current navigation mode. Its <code>href</code> and <code>referrer</code> values are the navigation destination and initial URLs. The rest of its properties are aligned with the <a href="/react-router/x/Link_props">link props</a> (with <code>id</code> corresponding to the link's <code>data-id</code> and with the <code>data-</code> prefix stripped from the props' names).</p>
<p>⬥ The callback of both hooks is first called when the component gets mounted if the route is already in the navigation-complete state.</p>
<p>⬥ The optional <code>callback</code> parameter of <code>useRoute(callback?)</code> can be used as middleware defining certain actions to be taken right before or after components get notified to re-render in response to a URL change. This callback receives the <code>render</code> function as a parameter that should be called at some point. Use cases for this callback include, for example, activating <a href="/react-router/x/Animated_view_transitions">animated view transitions</a> or skipping re-renders for certain URL changes.</p>
<p class="pagenav">
  <span class="prev">
    <span class="icon">←</span>
    <a href="/react-router/x/Link_props">Link props</a>
  </span>
  <span class="sep">|</span>
  <span class="next"><a href="/react-router/x/URL_parameters">URL parameters</a> <span class="icon">→</span></span>
</p>
</main>
<hr>
<nav class="aux">
<section>
<p class="title">Contents</p>
<ul><li data-id="Routing"><a href="/react-router/x/Routing">Routing</a></li>
<li data-id="Navigation"><a href="/react-router/x/Navigation">Navigation</a></li>
<li data-id="Link_props"><a href="/react-router/x/Link_props">Link props</a></li>
<li data-id="Middleware"><strong>Middleware</strong></li>
<li data-id="URL_parameters"><a href="/react-router/x/URL_parameters">URL parameters</a></li>
<li data-id="Type_safety"><a href="/react-router/x/Type_safety">Type safety</a></li>
<li data-id="Nested_routes"><a href="/react-router/x/Nested_routes">Nested routes</a></li>
<li data-id="URL_provider"><a href="/react-router/x/URL_provider">URL provider</a></li>
<li data-id="Custom_routing_behavior"><a href="/react-router/x/Custom_routing_behavior">Custom routing behavior</a></li>
<li data-id="Unknown_routes"><a href="/react-router/x/Unknown_routes">Unknown routes</a></li>
<li data-id="Lazy_routes"><a href="/react-router/x/Lazy_routes">Lazy routes</a></li>
<li data-id="Animated_view_transitions"><a href="/react-router/x/Animated_view_transitions">Animated view transitions</a></li>
<li data-id="Converting_HTML_links_to_SPA_route_links"><a href="/react-router/x/Converting_HTML_links_to_SPA_route_links">Converting HTML links to SPA route links</a></li>
</ul>
<p class="title">Resources</p>
<ul>
  <li><a href="https://github.com/t8js/react-router" target="_blank">GitHub</a></li>
  <li><a href="https://www.npmjs.com/package/@t8/react-router" target="_blank">npm</a></li>
</ul>
</section>
<section class="related">
  <p class="title">Also with React</p>
  <ul>
    <li><a href="/react-store" data-name="@t8/react-store">T8 <strong>React Store</strong></a></li>
    <li><a href="/react-pending" data-name="@t8/react-pending">T8 <strong>React Pending</strong></a></li>
  </ul>
  <p class="title">Vanilla TS/JS</p>
  <ul>
    <li><a href="/router" data-name="@t8/router">T8 <strong>Router</strong></a></li>
    <li><a href="/store" data-name="@t8/store">T8 <strong>Store</strong></a></li>
  </ul>
</section>
</nav>
</div>
</div>
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/stackoverflow-light.min.css" media="(prefers-color-scheme: light)">
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/base16/material.min.css" media="(prefers-color-scheme: dark)">
<link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.3/dist/css/code.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
<script>hljs.highlightAll()</script>
<script src="/assets/stats.js"></script>
</body>
</html>
