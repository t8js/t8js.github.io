<!DOCTYPE html>
<html lang="en" style="--base-color: #5900c8">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="T8 React Pending: Usage">
  <title>Usage | T8 React Pending</title>
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.1/dist/css/base.css">
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.1/dist/css/section.css">
  <link rel="icon" type="image/png" href="/assets/t8.png">
  
  
</head>
<body>
<div class="layout">
<div class="body">
<main>
<h1><a href="/react-pending/" class="name">T8 React Pending</a></h1>
<h2 id="usage">Usage</h2>
<p>Objective: Track the pending state of the async <code>fetchItems()</code> action to tell the user whether the UI is busy or encountered an error (preferably without rewriting the action and the app's state management).</p>
<pre><code class="language-diff">+ import { usePendingState } from "@t8/react-pending";

  const ItemList = () =&gt; {
    const [items, setItems] = useState([]);
    // the custom string key parameter tags the action's state so
    // that another component can access this state by the same tag
+   const [state, withState] = usePendingState("fetch-items");

    useEffect(() =&gt; {
      // wrapping fetchItems() to track the async action's state
-     fetchItems().then(setItems);
+     withState(fetchItems()).then(setItems);
    }, [fetchItems, withState]);

+   if (!state.complete)
+     return &lt;p&gt;Loading...&lt;/p&gt;;

+   if (state.error)
+     return &lt;p&gt;An error occurred&lt;/p&gt;;

    return &lt;ul&gt;{items.map(/* ... */)}&lt;/ul&gt;;
  };

  const Status = () =&gt; {
    // reading the "fetch-items" state updated in ItemList
+   const [state] = usePendingState("fetch-items");

    if (!state.initialized)
      return "Initial";

    if (!state.complete)
      return "Busy";

    if (state.error)
      return "Error";

    return "OK";
  };
</code></pre>
<p><a href="https://codesandbox.io/p/sandbox/rrr9cl?file=%2Fsrc%2FItemList.tsx" target="_blank">Live demo</a></p>
<p>üîπ If the action's state is only used within a single component, it can be used locally by omitting the custom string key parameter of the <code>usePendingState()</code> hook.</p>
<pre><code class="language-diff">- const [state, withState] = usePendingState("fetch-items");
+ const [state, withState] = usePendingState();
</code></pre>
<p>üîπ In the example above, the action's value (the <code>items</code> array) is stored in the component's local state, but it can certainly live in the app's shared state of the developer's choice instead.</p>
<p>üîπ Silently tracking the action's pending state, e.g. with background or optimistic updates (preventing <code>state.complete</code> from switching to <code>false</code> in the pending state):</p>
<pre><code class="language-diff">- withState(fetchItems())
+ withState(fetchItems(), { silent: true })
</code></pre>
<p>üîπ Revealing the action's pending state after a delay (e.g. to avoid flashing a process indicator when the action is likely to complete by the end of the delay):</p>
<pre><code class="language-diff">- withState(fetchItems())
+ withState(fetchItems(), { delay: 500 })
</code></pre>
<p>üîπ Allowing the action's Promise value to reject explicitly (e.g. in order to provide the action with a custom rejection handler) along with exposing <code>state.error</code> that goes by default:</p>
<pre><code class="language-diff">- withState(fetchItems())
+ withState(fetchItems(), { throws: true }).catch(handleError)
</code></pre>
<p>üîπ Providing an isolated instance of initial shared action state, e.g. for tests or SSR (it can be unnecessary for client-side rendering where the default context value is sufficient, but it can also be used to separate action states of larger self-contained portions of a web app):</p>
<pre><code class="language-diff">+ import { PendingStateProvider } from "@t8/react-pending";

- &lt;App/&gt;
+ &lt;PendingStateProvider&gt;
+   &lt;App/&gt;
+ &lt;/PendingStateProvider&gt;
</code></pre>
<p>üîπ Setting a custom initial action state (which is fully optional):</p>
<pre><code class="language-diff">+ const initialState = {
+   "fetch-items": { initialized: true, complete: true },
+ };

- &lt;PendingStateProvider&gt;
+ &lt;PendingStateProvider value={initialState}&gt;
    &lt;App/&gt;
  &lt;/PendingStateProvider&gt;
</code></pre>
<p>With an explicit value or without, the <code>&lt;PendingStateProvider&gt;</code>'s nested components will only respond to updates in the particular action states they subscribed to by means of <code>usePendingState("action-key")</code>.</p>

<p class="pagenav">
  <span class="prev">
    <span class="icon">‚Üê</span>
    <a href="/react-pending/">Intro</a>
  </span>
  <span class="sep">|</span>
  <span class="repo next"><a href="https://github.com/t8js/react-pending" target="_blank">GitHub</a> <span class="icon">‚ú¶</span></span>
</p>
</main>
<hr>
<nav>

<section class="ref">
  <ul>
    <li><a href="https://github.com/t8js/react-pending" target="_blank">GitHub</a></li>
    
  </ul>
</section>

<section class="related">
  <p class="title">Also with React</p>
  <ul>
    <li><a href="/react-router" data-name="@t8/react-router">T8 <strong>React Router</strong></a></li>
    <li><a href="/react-store" data-name="@t8/react-store">T8 <strong>React Store</strong></a></li>
    
  </ul>
  <p class="title">Vanilla TS/JS</p>
  <ul>
    <li><a href="/router" data-name="@t8/router">T8 <strong>Router</strong></a></li>
    <li><a href="/store" data-name="@t8/store">T8 <strong>Store</strong></a></li>
  </ul>
</section>

</nav>
</div>
</div>

<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/base16/material.min.css">
<link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.1/dist/css/code.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
<script>hljs.highlightAll()</script>
<script>
(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
m[i].l=1*new Date();
for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window, document, "script", "https://mc.yandex.com/metrika/tag.js", "ym");
ym(103784239, "init", {clickmap: true, trackLinks: true, accurateTrackBounce: true});
</script>
<noscript><div><img src="https://mc.yandex.com/watch/103784239" style="position:absolute;left:-9999px;" alt=""></div></noscript>
</body>
</html>
