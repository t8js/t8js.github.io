<!DOCTYPE html>
<html lang="en" data-layout="section">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="T8 React Pending: Overview">
  <title>Overview | T8 React Pending</title>
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.4/dist/css/base.css">
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.4/dist/css/section.css">
  <link rel="icon" type="image/png" href="/assets/t8.png">
  <link rel="stylesheet" href="/assets/entry.css">
</head>
<body>
<div class="layout">
<header class="aux">
  <h1><a href="/">T8</a> React Pending</h1>
  <div class="description">
    <p>Shared and local async action state management for React apps without affecting the app state management</p>
  </div>
</header>
<div class="body">
<main>
<h2 id="Shared_pending_state">Shared pending state</h2>
<p>Objective: Track the pending state of the asynchronous action <code>fetchItems()</code> to tell the user whether the UI is busy handling the async action or encountered an error, without rewriting the action and the app's state management.</p>
<p>In our setup, there are two components rendering their content with regard to the current state of <code>fetchItems()</code>, so the pending state is shared between these components:</p>
<pre><code class="language-diff">+ import { usePendingState } from "@t8/react-pending";

  export let ItemList = () =&gt; {
    let [items, setItems] = useState([]);
+   let { initial, pending, error, track } = usePendingState("fetch-items");

    useEffect(() =&gt; {
-     fetchItems().then(setItems);
+     track(fetchItems()).then(setItems);
    }, [fetchItems, track]);

+   if (initial || pending) return &lt;p&gt;Loading...&lt;/p&gt;;
+   if (error) return &lt;p&gt;An error occurred&lt;/p&gt;;

    return &lt;ul&gt;{items.map(/* ... */)}&lt;/ul&gt;;
  };
</code></pre>
<pre><code class="language-diff">+ import { usePendingState } from "@t8/react-pending";

  export let Status = () =&gt; {
+   let { initial, pending, error } = usePendingState("fetch-items");

    if (initial) return null;
    if (pending) return &lt;&gt;Busy&lt;/&gt;;
    if (error) return &lt;&gt;Error&lt;/&gt;;

    return &lt;&gt;OK&lt;/&gt;;
  };
</code></pre>
<p><a href="https://codesandbox.io/p/sandbox/rrr9cl?file=%2Fsrc%2FItemList.tsx" target="_blank">Live demo</a></p>
<p>⬥ To share the async action's pending state with multiple components we're using the string key parameter of <code>usePendingState(stateKey)</code>. This key can be used with <code>usePendingState(stateKey)</code> in other components to refer to the same pending state (as in the <code>Status</code> component above), so <code>stateKey</code> should be unique to the particular pending state.</p>
<p>⬥ In the example above, the data returned from the async action (the <code>items</code> array) is stored in the component's local state, but it can be stored in any app state of the developer's choice without affecting how the <code>usePendingState()</code> hook is used.</p>
<h2 id="Local_pending_state">Local pending state</h2>
<p>Omit the custom string key parameter of <code>usePendingState()</code> to scope the pending state locally within a single component:</p>
<pre><code class="language-diff">- let { initial, pending, error } = usePendingState("fetch-items"); // shared
+ let { initial, pending, error } = usePendingState(); // local
</code></pre>
<h2 id="Silent_tracking_of_background_actions_and_optimistic_updates">Silent tracking of background actions and optimistic updates</h2>
<pre><code class="language-diff">- track(fetchItems())
+ track(fetchItems(), { silent: true })
</code></pre>
<p>⬥ This option prevents the <code>pending</code> property from switching to <code>true</code> in the pending state.</p>
<h2 id="Delayed_pending_state">Delayed pending state</h2>
<pre><code class="language-diff">- track(fetchItems())
+ track(fetchItems(), { delay: 500 }) // in milliseconds
</code></pre>
<p>⬥ Use case: avoiding flashing a process indicator when the action is likely to complete by the end of a short delay.</p>
<h2 id="Custom_rejection_handler">Custom rejection handler</h2>
<pre><code class="language-diff">- track(fetchItems())
+ track(fetchItems(), { throws: true }).catch(handleError)
</code></pre>
<p>⬥ This option allows the async action to reject explicitly, along with exposing <code>error</code> returned from <code>usePendingState()</code> that goes by default.</p>
<h2 id="Providing_blank_initial_pending_state">Providing blank initial pending&nbsp;state</h2>
<pre><code class="language-diff">+ import { PendingStateProvider } from "@t8/react-pending";

- &lt;App/&gt;
+ &lt;PendingStateProvider&gt;
+   &lt;App/&gt;
+ &lt;/PendingStateProvider&gt;
</code></pre>
<p>⬥ <code>&lt;PendingStateProvider&gt;</code> creates an isolated instance of initial shared action state. Its prime use cases are SSR and tests. It isn't required with client-side rendering, but it can be used to separate action states of larger self-contained portions of an app.</p>
<h2 id="Providing_custom_initial_pending_state">Providing custom initial pending&nbsp;state</h2>
<pre><code class="language-diff">+ let initialState = {
+   "fetch-items": { initial: false, pending: true },
+ };

- &lt;PendingStateProvider&gt;
+ &lt;PendingStateProvider value={initialState}&gt;
    &lt;App/&gt;
  &lt;/PendingStateProvider&gt;
</code></pre>
<p>⬥ While fully optional, this setup allows to redefine the initial state received from <code>usePendingState(stateKey)</code>.</p>
<p>⬥ With an explicit value or without, the <code>&lt;PendingStateProvider&gt;</code>'s nested components will only respond to updates in the particular action states they subscribed to by means of <code>usePendingState(stateKey)</code>.</p>
<p class="pagenav">
  <span class="prev">
    <span class="icon">←</span>
    <a href="/react-pending/">Intro</a>
  </span>
  <span class="sep">|</span>
  <span class="repo"><a href="https://github.com/t8js/react-pending" target="_blank">GitHub</a></span>
</p>
</main>
<hr>
<aside class="aux">
  <div class="header" hidden>
    <h1><a href="/">T8</a> React Pending</h1>
    <div class="description">
      <p>Shared and local async action state management for React apps without affecting the app state management</p>
      <p class="installation"><code>npm i @t8/react-pending</code></p>
    </div>
  </div>
<nav>
<section>
<p class="title">Contents</p>
<ul><li><a href="/react-pending/x/Overview#Shared_pending_state">Shared pending state</a></li>
<li><a href="/react-pending/x/Overview#Local_pending_state">Local pending state</a></li>
<li><a href="/react-pending/x/Overview#Silent_tracking_of_background_actions_and_optimistic_updates">Silent tracking of background actions and optimistic updates</a></li>
<li><a href="/react-pending/x/Overview#Delayed_pending_state">Delayed pending state</a></li>
<li><a href="/react-pending/x/Overview#Custom_rejection_handler">Custom rejection handler</a></li>
<li><a href="/react-pending/x/Overview#Providing_blank_initial_pending_state">Providing blank initial pending&nbsp;state</a></li>
<li><a href="/react-pending/x/Overview#Providing_custom_initial_pending_state">Providing custom initial pending&nbsp;state</a></li>
</ul>
<p class="title">Resources</p>
<ul>
  <li><a href="https://github.com/t8js/react-pending" target="_blank">GitHub</a></li>
  <li><a href="https://www.npmjs.com/package/@t8/react-pending" target="_blank">npm</a></li>
</ul>
</section>
<section class="related">
  <p class="title">Also with React</p>
  <ul>
    <li><a href="/react-router" data-name="@t8/react-router">T8 React Router</a></li>
    <li><a href="/react-store" data-name="@t8/react-store">T8 React Store</a></li>
  </ul>
  <p class="title">Vanilla TS/JS</p>
  <ul>
    <li><a href="/router" data-name="@t8/router">T8 Router</a></li>
    <li><a href="/store" data-name="@t8/store">T8 Store</a></li>
    <li><a href="https://github.com/t8js/persistent-store" data-name="@t8/persistent-store">T8 Persistent Store</a></li>
  </ul>
</section>
</nav>
</aside>
</div>
</div>
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/stackoverflow-light.min.css" media="(prefers-color-scheme: light)">
<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/base16/material.min.css" media="(prefers-color-scheme: dark)">
<link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.4/dist/css/code.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
<script>hljs.highlightAll()</script>
<script src="/assets/stats.js"></script>
</body>
</html>
