<!DOCTYPE html>
<html lang="en" style="--base-color: #5900c8">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="T8 React Store: Overview">
  <title>Overview | T8 React Store</title>
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.1/dist/css/base.css">
  <link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.1/dist/css/section.css">
  <link rel="icon" type="image/png" href="/assets/t8.png">
</head>
<body>
<div class="layout">
<div class="body">
<main>
<h1><a href="/react-store/" class="name">T8 React Store</a></h1>
<h2>Shared state setup</h2>
<p>Moving the local state to the full-fledged shared state:</p>
<pre><code class="language-diff">  import { createContext, useContext } from "react";
+ import { Store, useStore } from "@t8/react-store";
+
+ let AppContext = createContext(new Store(0));

  let Counter = () =&gt; {
-   let [counter, setCounter] = useState(0);
+   let [counter, setCounter] = useStore(useContext(AppContext));

    let handleClick = () =&gt; {
      setCounter(value =&gt; value + 1);
    };

    return &lt;button onClick={handleClick}&gt;{counter}&lt;/button&gt;;
  };

  let ResetButton = () =&gt; {
-   let [, setCounter] = useState(0);
+   let [, setCounter] = useStore(useContext(AppContext), false);

    let handleClick = () =&gt; {
      setCounter(0);
    };

    return &lt;button onClick={handleClick}&gt;√ó&lt;/button&gt;;
  };

  let App = () =&gt; &lt;&gt;&lt;Counter/&gt;{" "}&lt;ResetButton/&gt;&lt;/&gt;;
</code></pre>
<p><a href="https://codesandbox.io/p/sandbox/rtng37?file=%2Fsrc%2FPlusButton.jsx" target="_blank">Live counter demo</a><br>
<a href="https://codesandbox.io/p/sandbox/tq852v?file=%252Fsrc%252FApp.tsx" target="_blank">Tic-tac-toe</a></p>
<p>üîπ The shared state setup shown above is very similar to <code>useState()</code> allowing for quick migration from local state to shared state or the other way around.</p>
<p>üîπ The <code>false</code> parameter in <code>useStore(store, false)</code> (as in <code>&lt;ResetButton&gt;</code> above) tells the hook not to subscribe the component to tracking the store state updates. The common use case is when a component makes use of the store state setter without using the store state value.</p>
<h2>Single store or multiple stores</h2>
<p>An application can have as many stores as needed, whether on a single React Context or multiple Contexts.</p>
<pre><code class="language-js">let AppContext = createContext({
  users: new Store(/* ... */),
  items: new Store(/* ... */),
});
</code></pre>
<p>üîπ Splitting data into multiple stores helps maintain more targeted subscriptions to data changes in components.</p>
<h2>Filtering store updates</h2>
<p>When only the store state setter is required, without the store state value, we can opt out from subscription to store state changes by passing <code>false</code> as the parameter of <code>useStore()</code>:</p>
<pre><code class="language-js">let [, setState] = useState(store, false);
</code></pre>
<p>Apart from a boolean, <code>useStore(store, shouldUpdate)</code> can take a function of <code>(nextState, prevState) =&gt; boolean</code> as the second parameter to filter store updates to respond to:</p>
<pre><code class="language-jsx">let ItemCard = ({ id }) =&gt; {
  // Definition of changes in the item
  let hasRelevantUpdates = useCallback((nextItems, prevItems) =&gt; {
    // Assuming that items have a `revision` property
    return nextItems[id].revision !== prevItems[id].revision;
  }, [id]);

  let [items, setItems] = useStore(
    useContext(AppContext).items,
    hasRelevantUpdates,
  );

  return (
    // Content
  );
};
</code></pre>
<h2>Providing shared state</h2>
<p>Shared state can be provided to the app by means of a regular React Context provider:</p>
<pre><code class="language-diff">  let App = () =&gt; (
-   &lt;AppContext.Provider value={42}&gt;
+   &lt;AppContext.Provider value={new Store(42)}&gt;
      &lt;PlusButton/&gt;{" "}&lt;Display/&gt;
    &lt;/AppContext.Provider&gt;
  );
</code></pre>
<h2>Store data</h2>
<p>A store can contain data of any type.</p>
<p>Live demos:<br>
<a href="https://codesandbox.io/p/sandbox/rtng37?file=%2Fsrc%2FPlusButton.jsx" target="_blank">Primitive value state</a><br>
<a href="https://codesandbox.io/p/sandbox/y7wt2j?file=%2Fsrc%2FPlusButton.jsx" target="_blank">Object value state</a></p>
<h2>With Immer</h2>
<p>Immer can be used with <code>useStore()</code> just the same way as <a href="https://immerjs.github.io/immer/example-setstate#usestate--immer" target="_blank">with <code>useState()</code></a> to facilitate deeply nested data changes.</p>
<p><a href="https://codesandbox.io/p/sandbox/rn4qsr?file=%2Fsrc%2FPlusButton.jsx" target="_blank">Live demo with Immer</a></p>
<h2>Shared loading state</h2>
<p>The ready-to-use hook from the <a href="https://github.com/t8js/react-pending" target="_blank">T8 React Pending</a> package helps manage shared async action state without disturbing the app's state management and actions' code.</p>
<h2>Standalone store</h2>
<p>A store initialized outside a component can be used as the component's remount-persistent state.</p>

<p class="pagenav">
  <span class="prev">
    <span class="icon">‚Üê</span>
    <a href="/react-store/">Intro</a>
  </span>
  <span class="sep">|</span>
  <span class="repo next"><a href="https://github.com/t8js/react-store" target="_blank">GitHub</a> <span class="icon">‚ú¶</span></span>
</p>
</main>
<hr>
<nav>

<section class="ref">
  <ul>
    <li><a href="https://github.com/t8js/react-store" target="_blank">GitHub</a></li>
    
  </ul>
</section>

<section class="related">
  <p class="title">Also with React</p>
  <ul>
    <li><a href="/react-router" data-name="@t8/react-router">T8 <strong>React Router</strong></a></li>
    
    <li><a href="/react-pending" data-name="@t8/react-pending">T8 <strong>React Pending</strong></a></li>
  </ul>
  <p class="title">Vanilla TS/JS</p>
  <ul>
    <li><a href="/router" data-name="@t8/router">T8 <strong>Router</strong></a></li>
    <li><a href="/store" data-name="@t8/store">T8 <strong>Store</strong></a></li>
  </ul>
</section>

</nav>
</div>
</div>

<link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/base16/material.min.css">
<link rel="stylesheet" href="https://unpkg.com/@t8/docsgen@0.1/dist/css/code.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
<script>hljs.highlightAll()</script>

<script src="/assets/stats.js"></script>
</body>
</html>
